<!DOCTYPE html>
<html lang="zh">

	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta http-equiv="X-UA-Compatible" content="ie=edge" />
		<title>商城</title>
		<link rel="shortcut icon" href="image/aa.png" type="image/x-icon" />
		<link rel="stylesheet" type="text/css" href="css/reset.css" />
		<link rel="stylesheet" type="text/css" href="css/shopping.css"/>
		<script src="js/jquery-2.1.4.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/jquery.fly.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/remove.js" type="text/javascript" charset="utf-8"></script>
	</head>

	<body>
		<!--头部-->
		<header>
			<div class="header">
				<div class="text">分类</div>
			</div>
		</header>
		
		<div class="container">
			<!--请输入你要查找的商品-->
			<nav>
				<ul>
					<input type="text" id="sousuo" value="" placeholder="请输入你要查找的商品" autofocus="autofocus" />
				</ul>
			</nav>
			<!--分页-->
			<main>
				<div class="fenye">
					<div class="fenye_left">
						<ul>
							<li class="active">推荐商品</li>
							<li>特色服务</li>
							<li>产品组合</li>
							<li>专业护理</li>
							<li>基础护理</li>
						</ul>
					</div>
					<!--所有商品-->
					<div class="fenye_right fenye_rights">
						<div id="tip">
							<img style="width: 100%;" src="https://s10.mogucdn.com/p2/161213/upload_74hhee883cbf190e3di6cljk23679_514x260.png"/>
							<p>没有相关的数据</p>
						</div>
						<div class="shop_list shop_lists">
							<a href="ziyemian/shopping_xq.html"><img src="image/aa.png" /></a>
							<div class="fenye_right_div">
								<h4>1口腔溃疡</h4>
								<h6>嘴腔疾病</h6>
								<div>
									<h5>￥<a>34.80</a><del>￥46.80</del></h5>
									<div>
										<i class="icon iconfont icon-jian jian1"></i>
										<input type="text" readonly="readonly" id="shu" class="shu" value="0" />
										<i class="icon iconfont icon-jia jia1"></i>	
									</div>
								</div>
							</div>
							<div class="cel"></div>
						</div>
						
						<div class="shop_list shop_lists">
							<a href="ziyemian/shopping_xq.html"><img src="image/aa.png" /></a>
							<div class="fenye_right_div">
								<h4>2口腔溃疡</h4>
								<h6>嘴腔疾病</h6>
								<div>
									<h5>￥<a>34.80</a><del>￥46.80</del></h5>
									<div>
										<i class="icon iconfont icon-jian jian1"></i>
										<input type="text" readonly="readonly" id="shu" class="shu" value="0" />
										<i class="icon iconfont icon-jia jia1"></i>	
									</div>
								</div>
							</div>
							<div class="cel"></div>
						</div>

					</div>
					<!--特色服务-->
					<div class="fenye_right hide">
						
						<div class="shop_list">
							<a href="ziyemian/shopping_xq.html"><img src="image/aa.png" /></a>
							<div class="fenye_right_div">
								<h4>3口腔溃疡</h4>
								<h6>嘴腔疾病</h6>
								<div>
									<h5>￥<a>34.80</a><del>￥46.80</del></h5>
									<div>
										<i class="icon iconfont icon-jian jian1"></i>
										<input type="text" readonly="readonly" id="shu" class="shu" value="0" />
										<i class="icon iconfont icon-jia jia1"></i>		
									</div>
								</div>
							</div>
							<div class="cel"></div>
						</div>
					</div>
					<!--产品组合-->
					<div class="fenye_right hide">
						<div class="shop_list">
							<a href="ziyemian/shopping_xq.html"><img src="image/aa.png" /></a>
							<div class="fenye_right_div">
								<h4>4口腔溃疡</h4>
								<h6>嘴腔疾病</h6>
								<div>
									<h5>￥<a>34.80</a><del>￥46.80</del></h5>
									<div>
										<i class="icon iconfont icon-jian jian1"></i>
										<input type="text" readonly="readonly" id="shu" class="shu" value="0" />
										<i class="icon iconfont icon-jia jia1"></i>		
									</div>
								</div>
							</div>
							<div class="cel"></div>
						</div>
					</div>
					<!--专业护理-->
					<div class="fenye_right hide">
						<div class="shop_list">
							<a href="ziyemian/shopping_xq.html"><img src="image/aa.png" /></a>
							<div class="fenye_right_div">
								<h4>5口腔溃疡</h4>
								<h6>嘴腔疾病</h6>
								<div>
									<h5>￥<a>34.80</a><del>￥46.80</del></h5>
									<div>
										<i class="icon iconfont icon-jian jian1"></i>
										<input type="text" readonly="readonly" id="shu" class="shu" value="0" />
										<i class="icon iconfont icon-jia jia1"></i>		
									</div>
								</div>
							</div>
							<div class="cel"></div>
						</div>
					</div>
					<!--基础护理-->
					<div class="fenye_right hide">
						<div class="shop_list">
							<a href="ziyemian/shopping_xq.html"><img src="image/aa.png" /></a>
							<div class="fenye_right_div">
								<h4>6口腔溃疡</h4>
								<h6>嘴腔疾病</h6>
								<div>
									<h5>￥<a>34.80</a><del>￥46.80</del></h5>
									<div>
										<i class="icon iconfont icon-jian jian1"></i>
										<input type="text" readonly="readonly" id="shu" class="shu" value="0" />
										<i class="icon iconfont icon-jia jia1"></i>		
									</div>
								</div>
							</div>
							<div class="cel"></div>
						</div>
					</div>

				</div>
				<!--已选商品-->
				<div class="gouwu"></div>
			</main>
			<!--合计-->
			<div class="gouwu1">
				<ul id="gouwu1_ul" style="z-index: 999;">
					<li>
						<h4>已选商品</h4><span class="qingkong">清空</span>
					</li>
					
					<div class="list">
						
					</div>
				</ul>
			</div>
			
			<div class="heji">
				<i class="icon iconfont icon-car gouwuce" id="end"></i>
				<div class="yuan">0</div>
				<h6>合计：￥<span class="hesuan">0</span></h6>
				<h5 id="jishuan"><a href="ziyemian/Settlement.html">去结算</a></h5>
			</div>
		</div>
		<!--模态框提示框-->
		<div class="bg-model" style="position:absolute;top:0%;left:0%;display:none;background:rgba(0,0,0,0.3);width:100%;height:100%;position:fixed;z-index:9999">
			<div class='content' style="position: absolute;left: 25%;top: 40%;border-radius: 8px;width: 50vw;height: 13vh;background-color: #000000; opacity: 0.8;">
				<h1 style="text-align: center; margin-top: 15%; font-size: 20px; color: #FFFFFF;">再按一次退出应用</h1>
			</div>
		</div>
		<!--底部-->
		<footer>
			<ul>
				<li class="icon-liebiao"><a href="index.html"><i class="icon iconfont icon-index"></i><br />首页</a></li>
				<li class="icon-liebiao active"><a href="shopping.html"><i class="icon iconfont icon-mall"></i><br />商城</a></li>
				<li class="icon-liebiao"><a href="hospital.html"><i class="icon iconfont icon-fujin"></i><br />附近医院</a></li>
				<li class="icon-liebiao"><a href="my.html"><i class="icon iconfont icon-wode"></i><br />我的</a></li>
			</ul>
		</footer>
	</body>
	<script type="text/javascript">
		$(function(){
			//JSON字符串转JSON对象
			var list = []

			$("#tip").hide()
			$('.fenye_left ul li').click(function(){
				
				$("#tip").hide()
				if($('#sousuo').val() == '') {
				      $("#tip").hide()
				 }
				if($(".fenye_rights .shop_lists").css('display')=='none'){
					$("#tip").show()

				}else{
					$("#tip").hide()
				}
				
			})
		
//		搜索功能
		$(".container").on("input","#sousuo",function(){
			var keyword = $(this).val()
			 $('.fenye_right .shop_list').hide()//将原有的内容隐藏
			 //然后将含有keyword的li进行渐变显示
			 $(".fenye_right .shop_list h4").filter(":Contains("+keyword+")").parents('.fenye_right .shop_list').fadeIn(200)
			 if($(".fenye_right .shop_list").length - $(".fenye_right .shop_list:hidden").length==0){
			 	$("#tip").show()
			 	
		     }else{
		     	$("#tip").hide()
		     } 
		})
		 
		 
		 $('#sousuo').on('click',function(){
			$('.heji').fadeOut(200)
			$('footer').fadeOut(200)
		 })
		$('#sousuo').on('blur',function(){
		 	$('.heji').fadeIn(200)
		 	$('footer').fadeIn(200)
		 })
			
			
			
//			分类选项
			$(".fenye_left li").click(function(){
				$(".fenye_left li").removeClass("active")
				$(this).addClass("active")	
				$(".fenye_right").addClass("hide")
				console.log($(this).index())
				$(".fenye_right").eq($(this).index()).removeClass("hide")
			})
//			清空
			$(document).on("click",".qingkong",function(){
				$("#gouwu1_ul").html('<li><h4>已选商品</h4><span class="qingkong">清空</span></li><div class="list"></div>')
				$(".yuan").text($("#gouwu1_ul li").length-1)
				$(".hesuan").text("0")
				hesuan=0
				
				console.log($(".fenye_right .shop_list .shu").eq(2).val())
				
				for (var i=0;i<$(".fenye_right .shop_list").length;i++) {
					$(".fenye_right .shop_list .shu").eq(i).val(0)
				}
				$('.jian1').hide()
				$('.shu').hide()
				
				localStorage.clear();
				localStorage.clear("temp2");
				localStorage.clear(list);
				
			})
//          添加			
			var html=""
			var cc=0;
			$('.jian1').hide()
			$('.shu').hide()
			$(document).on("click",".jia1",function(){
				if($(this).siblings('#shu').val() >= 0){
					$(this).siblings('#shu').show()
					$(this).siblings('.jian1').show()
				}
				$(this).siblings('#shu').val(parseInt($(this).siblings('#shu').val())+1) 
				
				html ='<li><h4>'+$(this).parent().parent().siblings('h4').html()+'</h4><h3>￥'+$(this).parent().siblings('h5').children("a").html()+'</h3><span><i class="icon iconfont icon-jian jian"></i>'+
				'<input type="text" class="shuliang" value="1" disabled="disabled"/><i class="icon iconfont icon-jia jia"></i></li>'
				
				
				
				var obj = {
					name:$(this).parent().parent().siblings('h4').html(),
					jiaqian:$(this).parent().siblings('h5').children("a").html(),
					shuliang:1
				};
				
				if(list.length == 0){
					list.push(obj)
				}else{
					for(var i=0;i<list.length;i++){
						if(list[i].name == $(this).parent().parent().siblings('h4').html()){
							list[i].shuliang++
							alert(1212)
						}else{
							list.push(obj)
						}
					}
				}
				console.log(list)
				
				
//				if(JSON.parse(localStorage.getItem("temp2")) != null){
//					list = JSON.parse(localStorage.getItem("temp2"))
//				}
//			　　list = JSON.stringify(list); //转化为JSON字符串
//			　　localStorage.setItem("temp2", list);



			
			
//			if(JSON.parse(localStorage.getItem("temp2")) != null){
//					list=JSON.parse(localStorage.getItem("temp2"));
//					console.log(list)
//					var htmls=""
//					for(var i=0;i<list.length;i++){
//						htmls +='<li><h4>'+list[i].name+'</h4><h3>￥'+list[i].jiaqian+'</h3><span><i class="icon iconfont icon-jian jian"></i>'+
//						'<input type="text" class="shuliang" value="'+ list[i].shuliang +'" disabled="disabled"/><i class="icon iconfont icon-jia jia"></i></li>'
//					}
//				}
			
			
			
				for (var i=0;i<$(".list li").length;i++) {
					if($(this).parent().parent().siblings('h4').html()==$(".list li").eq(i).children("h4").html()){
						aa=Number($(".list li").eq(i).children("span").children("input").val())+1
						Number($(".list li").eq(i).children("span").children("input").val(aa))
						cc=1
					}
				}
				
				
				if(cc==0){
//					$(".list").html(htmls)
					$(".list").append(html)
				}
				$(".yuan").text($("#gouwu1_ul li").length-1)
				hesuan = eval((parseFloat($(this).parent().siblings('h5').children("a").html())+hesuan).toFixed(2))
				$(".hesuan").text(hesuan)
				cc = 0
		})
			
		$(document).on("click",".jian1",function(){	
			if($(this).siblings('#shu').val() == 1){
					$(this).siblings('#shu').hide()
					$(this).hide()
				}
			
			var danjia=parseFloat($(this).parent().siblings('h5').children('a').text())
			if(parseInt($(this).siblings('#shu').val())<1){
					$(this).siblings('#shu').val(0) 
				}else{
					$(this).siblings('#shu').val(parseInt($(this).siblings('#shu').val())-1) 
					
					for (var i=0;i<$("#gouwu1_ul li").length;i++) {
						if($(this).parent().parent().siblings('h4').html()==$("#gouwu1_ul li").eq(i).children("h4").html()){
							aa=Number($("#gouwu1_ul li").eq(i).children("span").children("input").val())-1
							Number($("#gouwu1_ul li").eq(i).children("span").children("input").val(aa))
							if(Number($("#gouwu1_ul li").eq(i).children("span").children("input").val()) == 0){
								$("#gouwu1_ul li").eq(i).remove()
							}
						}
					}
					$(".yuan").text($("#gouwu1_ul li").length-1)
					hesuan = eval((hesuan-danjia).toFixed(2))
					$(".hesuan").text(hesuan)
				}
				
				
		})
			
			

//			减
			var hesuan=00;
			$(document).on("click",".jian",function(){
				var danjia=parseFloat($(this).parent().siblings('h3').text().substring(1))
				if(Number($(this).siblings('.shuliang').val())==1){
					$(this).parent().parent().remove()
					$(this).siblings('.shuliang').val(Number($(this).siblings('.shuliang').val())-1)
					hesuan = eval((hesuan-danjia).toFixed(2))
					$(".hesuan").text(hesuan)
					$(".yuan").text($("#gouwu1_ul li").length-1)
				}else{
					$(this).siblings('.shuliang').val(Number($(this).siblings('.shuliang').val())-1)
					hesuan = eval((hesuan-danjia).toFixed(2))
					$(".hesuan").text(hesuan)
				}
//				同步减
				for (var i=0;i<$(".fenye_right .shop_list").length;i++) {
					if($(".fenye_right .shop_list").eq(i).children('.fenye_right_div').children('h4').text() == $(this).parent().siblings('h4').text()){
					var	shu = $(".fenye_right .shop_list").eq(i).children('.fenye_right_div').children('div').children('div').children('#shu').val()
					$(".fenye_right .shop_list").eq(i).children('.fenye_right_div').children('div').children('div').children('#shu').val(Number(shu)-1)
					
						if(shu == 1){
							$(".fenye_right .shop_list").eq(i).children('.fenye_right_div').children('div').children('div').children('#shu').hide()
							$(".fenye_right .shop_list").eq(i).children('.fenye_right_div').children('div').children('div').children('.jian1').hide()
						}
					
					}
				}
			})
//			加
			$('#gouwu1_ul').on("click",".jia",function(){
				var danjia=parseFloat($(this).parent().siblings('h3').text().substring(1))
				$(this).siblings('.shuliang').val(Number($(this).siblings('.shuliang').val())+1)
				hesuan = eval((hesuan+danjia).toFixed(2))
				$(".hesuan").text(hesuan)
//				同步加				
				for (var i=0;i<$(".fenye_right .shop_list").length;i++) {
					if($(".fenye_right .shop_list").eq(i).children('.fenye_right_div').children('h4').text() == $(this).parent().siblings('h4').text()){
					var	shu = $(".fenye_right .shop_list").eq(i).children('.fenye_right_div').children('div').children('div').children('#shu').val()
					$(".fenye_right .shop_list").eq(i).children('.fenye_right_div').children('div').children('div').children('#shu').val(Number(shu)+1)
					}
				}
				
				
			})
			
//			购物车列表
			$(".gouwu").hide()
			$(".gouwu1").hide()
			$(".gouwuce").click(function(){	
				$(".gouwu").slideToggle()
				$(".gouwu1").slideToggle()
			})
			$(".gouwu").click(function(){			
				$(".gouwu").slideUp(1000)
				$(".gouwu1").slideUp(1000)
			})
     	});
     	
     	
//   	双击退出
		$(function(){
			document.addEventListener('plusready', function(a) {
            var first = null;
            plus.key.addEventListener('backbutton', function() {
                    //首次按键，提示‘再按一次退出应用’
                    if (!first) {
                        first = new Date().getTime();
                        $(".bg-model").fadeTo(300,1)
					     	setTimeout(function(){
						     	$(".bg-model").fadeOut(3000);
						     },1000)
                        console.log('再按一次退出应用');//用自定义toast提示最好
                        setTimeout(function() {
                            first = null;
                        }, 500);
                    } else {
                        if (new Date().getTime() - first < 1000) {
                            plus.runtime.quit();
                        }
                    }
                }, false);
        	});
		});
		
		
//      加入购物车效果		
		$(function() {
			$(window).scroll(function() {
				
			});
		    var offset = $("#end").offset();
		    $(".jia1").click(function(event){
		    	var img = $(this).parent().parent().parent().parent().find('img').attr('src');
		        var flyer = $('<img class="u-flyer" src="'+img+'">');
		        flyer.fly({
			            start: {
			                left: event.clientX, //开始位置（必填）#fly元素会被设置成position: fixed
			                top: event.clientY //开始位置（必填）
			            },
			            end: {
			                left: offset.left+10, //结束位置（必填）
			                top: offset.top+10, //结束位置（必填）
			                width: 0, //结束时宽度
			                height: 0 //结束时高度
			            }
			       });
		    });
		});
		
	</script>

</html>